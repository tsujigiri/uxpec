describe "uxpec/create-stack-snapshot 00
	context "when 20 "the 20 "stack 20 "is 20 "not 20 "empty 00
		it "creates 20 "a 20 "snapshot 00
			#1234 uxpec/create-stack-snapshot

			;uxpec/stack-stack-ptr LDA2
			LDAk #02 assert/equ ( load stack size )
			#0001 SUB2
			LDAk #12 assert/equ
			#0001 SUB2
			LDA #34 assert/equ

			( check that the stack itself is unchanged )
			#1234 assert/equ2

			assert/stack-empty
		end

		it "stacks 20 "multiple 20 "snapshots 00
			#0000 ;uxpec/stack-stack-ptr STA2
			#0000 ;uxpec/stack-stack-ptr-old STA2

			#1234 uxpec/create-stack-snapshot


			#5678 uxpec/create-stack-snapshot

			;uxpec/stack-stack-ptr LDA2 ;uxpec/stack-stack-ptr-old LDA2 SUB2
			#0004 assert/equ2

			;uxpec/stack-stack-ptr LDA2 ;uxpec/stack-stack SUB2
			#0007 assert/equ2

			;uxpec/stack-stack-ptr LDA2
			LDAk #04 assert/equ ( load stack size )
			#0001 SUB2
			LDAk #12 assert/equ
			#0001 SUB2
			LDAk #34 assert/equ
			#0001 SUB2
			LDAk #56 assert/equ
			#0001 SUB2
			LDAk #78 assert/equ

			#0001 SUB2
			LDAk #02 assert/equ ( load stack size )
			#0001 SUB2
			LDAk #12 assert/equ
			#0001 SUB2
			LDA #34 assert/equ

			( check stack state )
			#5678 assert/equ2
			#1234 assert/equ2

			assert/stack-empty
		end
	end

	context "when 20 "the 20 "stack 20 "is 20 "empty 00
		it "creates 20 "an 20 "empty 20 "snapshot 00
			#0000 ;uxpec/stack-stack-ptr STA2
			#0000 ;uxpec/stack-stack-ptr-old STA2
			assert/stack-empty

			uxpec/create-stack-snapshot

			;uxpec/stack-stack-ptr LDA2
			LDA #00 assert/equ ( load stack size )

			assert/stack-empty
		end
	end
end
